"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[430],{7345:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});var s=i(4848),r=i(8453);const c={sidebar_position:6},d="Packaging and versioning",a={id:"versioning",title:"Packaging and versioning",description:"DiracX is a comprehensive Python package, composed of several interconnected submodules. It's designed to provide robust and versatile functionalities, primarily through these key components:",source:"@site/docs/versioning.md",sourceDirName:".",slug:"/versioning",permalink:"/diracx/docs/versioning",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Architecture of Services",permalink:"/diracx/docs/services"},next:{title:"OpenTelemetry",permalink:"/diracx/docs/opentelemetry"}},o={},l=[{value:"Python Modules",id:"python-modules",level:2},{value:"Versioning Strategy",id:"versioning-strategy",level:3},{value:"Container Images",id:"container-images",level:2},{value:"Dependencies",id:"dependencies",level:3},{value:"Entrypoint",id:"entrypoint",level:3},{value:"Extensions",id:"extensions",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"packaging-and-versioning",children:"Packaging and versioning"}),"\n",(0,s.jsx)(n.p,{children:"DiracX is a comprehensive Python package, composed of several interconnected submodules. It's designed to provide robust and versatile functionalities, primarily through these key components:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"User-Facing Components"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx"})}),": This is the primary interface for users, integrating both the Command Line Interface (CLI) and Python API."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-routers"})}),": Serves as the server component, offering HTTPS endpoints."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-tasks"})}),": Handles operations executed by DiracX servers, either periodically or upon request."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Containerization"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each component is available as a container image, packaging DiracX along with all necessary dependencies."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"python-modules",children:"Python Modules"}),"\n",(0,s.jsx)(n.p,{children:"DiracX is structured into various modules, each serving a distinct purpose:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-core"})}),": The foundational code base, utilized by all other DiracX modules."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-db"})}),": Focuses on database functionalities."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-routers"})}),": Implements a FastAPI application."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-client"})}),": A client auto-generated from the OpenAPI specification in ",(0,s.jsx)(n.code,{children:"diracx-routers"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-api"})}),": Provides higher-level operations building on ",(0,s.jsx)(n.code,{children:"diracx-client"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx-cli"})}),": The command line interface (",(0,s.jsx)(n.code,{children:"dirac"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"diracx"})}),": A metapackage offering ",(0,s.jsx)(n.code,{children:"diracx-client"}),", ",(0,s.jsx)(n.code,{children:"diracx-api"}),", and ",(0,s.jsx)(n.code,{children:"diracx-cli"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["These modules are each implemented as a ",(0,s.jsx)(n.a,{href:"https://packaging.python.org/en/latest/guides/packaging-namespace-packages/",children:"native Python namespace package"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The direct dependencies between the submodules are as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2524 core \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n   \u250c\u2500\u2500\u25bc\u2500\u2510                \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510\n   \u2502 db \u251c\u2500\u2500\u2500\u2500\u2500\u2510          \u2502 client \u2502\n   \u2514\u2500\u252c\u2500\u2500\u2518     \u2502          \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510   \u2502            \u250c\u2500\u2500\u25bc\u2500\u2500\u2510\n\u2502 routers \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 api \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502        \u2514\u2500\u2500\u252c\u2500\u2500\u2518\n            \u250c\u2500\u25bc\u2500\u2500\u2500\u25bc\u2500\u2510      \u250c\u2500\u2500\u25bc\u2500\u2500\u2510\n            \u2502 tasks \u2502      \u2502 cli \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"versioning-strategy",children:"Versioning Strategy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Currently, and as long as ",(0,s.jsx)(n.code,{children:"DIRAC"})," and ",(0,s.jsx)(n.code,{children:"diracx"})," coexist, we employ a versioning format of ",(0,s.jsx)(n.code,{children:"v0.<major>.<patch>."})]}),"\n",(0,s.jsxs)(n.li,{children:["We only support using the same version across all ",(0,s.jsx)(n.code,{children:"diracx-*"})," packages."]}),"\n",(0,s.jsxs)(n.li,{children:["The client and server versions can vary, but the client version is always communicated to the server. Incompatibly old client versions may lead to request rejections, prompting a client update. (TODO: ",(0,s.jsx)(n.a,{href:"https://github.com/DIRACGrid/diracx/issues/258",children:"https://github.com/DIRACGrid/diracx/issues/258"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"container-images",children:"Container Images"}),"\n",(0,s.jsx)(n.p,{children:"DiracX utilizes a structured approach to containerization:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Base Image"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["All container images start from ",(0,s.jsx)(n.code,{children:"diracx/base"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Specialized Base Images"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"diracx/services-base"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"diracx/tasks-base"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"diracx/client-base"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Image Versioning and Building"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Images are built periodically (e.g., every Monday) and tagged as ",(0,s.jsx)(n.code,{children:"YYYY.MM.DD.P"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["A DiracX release triggers the creation of new ",(0,s.jsx)(n.code,{children:"DiracXService"}),", ",(0,s.jsx)(n.code,{children:"diracx/tasks"}),", and ",(0,s.jsx)(n.code,{children:"diracx/client"})," images, based on specific ",(0,s.jsx)(n.code,{children:"diracx/base"})," tags."]}),"\n",(0,s.jsx)(n.li,{children:"This approach ensures stability in production environments."}),"\n",(0,s.jsxs)(n.li,{children:["For testing purposes, the ",(0,s.jsx)(n.code,{children:"latest"})," base images are used, with dependencies installed via ",(0,s.jsx)(n.code,{children:"pip install"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"See this diagram for an example of how this looks in practice:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u250c\u2500\u2500\u2500\u2500\u2500\u2524 diracx/base:YYYY.MM.DD.P \u251c\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n                 \u2502                                      \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 diracx/services-base:YYYY.MM.DD.P \u2502  \u2502 diracx/tasks-base:YYYY.MM.DD.P \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502                                      \u2502\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502 diracx/services:v0.X.Y \u2502              \u2502 diracx/tasks:v0.X.Y \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["There is a noted duplication between ",(0,s.jsx)(n.code,{children:"setup.cfg"})," and ",(0,s.jsx)(n.code,{children:"environment.yaml"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"diracx/base"})," image is built from a Dockerfile with ",(0,s.jsx)(n.code,{children:"environment.yml"}),", primarily defining the Python version and ",(0,s.jsx)(n.code,{children:"dirac_environment.yaml"}),' containing the DIRAC specific dependencies. The latter is there as a "temporary" thing.']}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"diracx/services-base"})," and ",(0,s.jsx)(n.code,{children:"diracx/tasks-base"})," images extend ",(0,s.jsx)(n.code,{children:"diracx/base"})," with additional Dockerfiles and ",(0,s.jsx)(n.code,{children:"environment.yml"}),", tailored to their specific needs."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"diracx/services"})," and ",(0,s.jsx)(n.code,{children:"diracx/tasks"})," images are further built upon their respective base images, adding necessary diracx packages through ",(0,s.jsx)(n.code,{children:"pip install --no-dependencies"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"entrypoint",children:"Entrypoint"}),"\n",(0,s.jsx)(n.p,{children:"TODO: document the entry point"}),"\n",(0,s.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Extensions will extend one or more of ",(0,s.jsx)(n.code,{children:"diracx"}),", ",(0,s.jsx)(n.code,{children:"diracx-routers"}),", ",(0,s.jsx)(n.code,{children:"diracx-tasks"})," images (e.g. ",(0,s.jsx)(n.code,{children:"mydiracx"}),", ",(0,s.jsx)(n.code,{children:"mydiracx-routers"}),", ",(0,s.jsx)(n.code,{children:"mydiracx-tasks"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"Extensions provide a corresponding container image based on a specific release of the corresponding DiracX image."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>a});var s=i(6540);const r={},c=s.createContext(r);function d(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);